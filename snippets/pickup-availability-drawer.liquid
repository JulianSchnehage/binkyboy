{%- comment -%}
  Parameters:
  - current_variant {Object} - Current product variant.

  Usage:
  {% render 'pickup-availability-drawer', current_variant: current_variant %}
{%- endcomment -%}

{%- assign pick_up_availabilities = current_variant.store_availabilities | where: 'pick_up_enabled', true -%}

<side-drawer id="pickup-availability-{{ current_variant.id }}-{{ section.id }}" class="drawer fixed top-0 right-0 flex flex-col w-full has-motion js-pickup-drawer" role="dialog" tabindex="-1" aria-labelledby="pickup-availability-heading" aria-modal="true" aria-hidden="true">
  <header class="drawer__header drawer__header--with-line flex justify-between items-start">
    <div>
      <h2 class="mb-0 h4" id="pickup-availability-heading">
        {{- current_variant.product.title | escape -}}
      </h2>

      {%- unless current_variant.product.has_only_default_variant -%}
        <p class="m-0">
          {%- for product_option in current_variant.product.options_with_values -%}
            <strong>{{ product_option.name | escape }}:</strong>&nbsp;
            {%- for value in product_option.values -%}
              {%- if product_option.selected_value == value -%}
                <span>{{ value | escape }}</span>
              {%- endif -%}
            {%- endfor -%}
            {%- unless forloop.last -%}, {% endunless forloop.last -%}
          {%- endfor -%}
        </p>
      {%- endunless -%}
    </div>
    <button type="button" class="drawer__close-btn js-close-drawer">
      <span class="visually-hidden">{{ 'accessibility.close' | t }}</span>
      {% render 'icon-close' %}
    </button>
  </header>
  <div class="drawer__content flex-auto">
    <ul role="list">
      {%- for availability in pick_up_availabilities -%}
        <li>
          {% unless forloop.first %}<hr>{% endunless %}
          <div class="font-semibold" role="heading" aria-level="3">{{ availability.location.name | escape }}</div>
          <div class="flex">
            {%- if availability.available -%}
              <div class="pickup-icon text-success-text">
                {% render 'icon-available' %}
              </div>
              <p>
                {{ 'products.product.pickup_availability.pick_up_available' | t }},
                {{ availability.pick_up_time | downcase }}
              </p>
            {%- else -%}
              <div class="pickup-icon text-error-text">
                {% render 'icon-unavailable' %}
              </div>
              <p>{{ 'products.product.pickup_availability.pick_up_unavailable' | t }}</p>
            {%- endif -%}
          </div>
          {%- assign address = availability.location.address -%}
          <address>
            {{ address | format_address }}
            {%- if address.phone.size > 0 -%}
              {{ address.phone }}
            {%- endif -%}
          </address>
        </li>
      {%- endfor -%}
    </ul>
  </div>
</side-drawer>
